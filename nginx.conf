server {
    listen 80;
    server_name _;

    # This is where the files are, based on your Dockerfile.
    root /usr/share/nginx/html;
    index index.html;

    # This block handles all requests for your Docusaurus app.
    location /knowledge/v2/ {
        # This rule strips the /knowledge/v2/ prefix from the URL.
        # For example: /knowledge/v2/assets/main.css becomes /assets/main.css
        # The 'break' flag tells nginx to process the rewritten URL within this same block.
        rewrite ^/knowledge/v2/(.*)$ /$1 break;

        # After the rewrite, nginx tries to find the file.
        # 1. $uri: Tries to find the file directly (e.g., /assets/main.css). This works for assets.
        # 2. $uri/: Tries to see if it's a directory.
        # 3. /index.html: If neither is found (e.g., for a page like /docs/intro),
        #    it serves the main index.html, letting the Docusaurus router take over.
        try_files $uri $uri/ /index.html;
    }

    # Standard gzip compression for better performance.
    gzip on;
    gzip_types text/plain text/css application/json application/javascript;
    gzip_min_length 256;
}
